<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
      <!--
		
		Generated at 2007-02-12T11:38:49.726Z-->
      <title>Saxonica: XSLT and XQuery Processing: saxon:for-each-group()</title>
      <meta name="coverage" content="Worldwide">
      <meta name="copyright" content="Copyright Saxonica Ltd">
      <meta name="title" content="Saxonica: XSLT and XQuery Processing: saxon:for-each-group()">
      <meta name="robots" content="noindex,nofollow">
      <link rel="stylesheet" href="../../saxondocs.css" type="text/css">
   </head>
   <body class="main">
      <div id="rhDkBlueArea" style="position:absolute; width:123px; height:1000px; z-index:2; right: 0px; top: 0px; border: 1px none #000000; background-color: #C1CEDE; layer-background-color: #C1CEDE; visibility: visible;"></div>
      <div id="rhMdBlueArea" style="position:absolute; width:217px; height:1000px; z-index:2; right: 340px; top: 0px; border: 1px none #000000; background-color: #E4EEF0; layer-background-color: #E4EEF0; visibility: visible;"></div>
      <div id="lhLightArea" style="position:absolute; width:34px; height:1000px; z-index:2; left: 66px; top: 0px; border: 1px none #000000; background-color: #f6fffb; layer-background-color: #E4EEF0; visibility: visible;"></div>
      <div id="lhDkBlueArea" style="position:absolute; width:66px; height:1000px; z-index:2; left: 0px; top: 0px; border: 1px none #000000; background-color: #C1CEDE; layer-background-color: #C1CEDE; visibility: visible;"></div>
      <div id="LogoArea" style="position:absolute; width:340px; height:72px; z-index:3; right: 0px; top: 0px; border: 1px none #000000; visibility: visible;"><a href="../../index/intro.html"><img src="../../img/saxonica_logo.gif" width="340" height="72" border="0" alt="Saxonica.com"></a></div>
      <div id="MenuArea" style="position:absolute; width:157px; z-index:4; right: 33px; top: 114px; visibility: visible; background-color: #f6fffb; layer-background-color: #f6fffb; border: 1px solid #3D5B96; padding-top:9px; padding-left:15px;padding-right:11px; padding-bottom:9px;">
         <table width="164" border="0" bgcolor="#3D5B96" cellspacing="1" cellpadding="1">
            <tr bgcolor="#f6fffb">
               <td style="padding-left:5px"><a href="http://www.saxonica.com/">SAXONICA</a></td>
            </tr>
         </table><br><table border="0" cellspacing="0" cellpadding="1">
            <tr>
               <td class="title" colspan="2">Saxon Documentation</td>
            </tr>
            <tr>
               <td colspan="2"><img src="../../img/spacer.gif" width="120" height="10" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../../contents.html">Full Contents</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../../index/intro.html">About Saxon</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../../changes/intro.html">Changes in this Release</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../../conditions/intro.html">Conditions of Use</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../../using-xsl/intro.html">Using XSLT 2.0</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../../using-xquery/intro.html">Using XQuery</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../../sourcedocs/intro.html">Handling Source Documents</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../../schema-processing/intro.html">XML Schema Processing</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../../xpath-api/intro.html">XPath API for Java</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../../dotnet/intro.html">Saxon on .NET</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../../extensibility/intro.html">Extensibility</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../../extensions/intro.html">Saxon Extensions</a></td>
            </tr>
            <tr>
               <td><img src="../../img/spacer.gif" width="10" height="5" border="0" alt="blank space"></td>
               <td><a href="../intro.html">Introduction</a></td>
            </tr>
            <tr>
               <td><img src="../../img/spacer.gif" width="10" height="5" border="0" alt="blank space"></td>
               <td><a href="../exslt.html">EXSLT Extensions</a></td>
            </tr>
            <tr>
               <td><img src="../../img/spacer.gif" width="10" height="5" border="0" alt="blank space"></td>
               <td><a href="../attributes.html">Extension attributes (XSLT only)</a></td>
            </tr>
            <tr>
               <td><img src="../../img/spacer.gif" width="10" height="5" border="0" alt="blank space"></td>
               <td><a href="../output-extras.html">Additional serialization parameters</a></td>
            </tr>
            <tr>
               <td>»&nbsp;</td>
               <td><a href="../functions.html">Extension functions</a></td>
            </tr>
            <tr>
               <td><img src="../../img/spacer.gif" width="10" height="5" border="0" alt="blank space"></td>
               <td><a href="../instructions.html">Extension instructions</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../../samples/intro.html">Sample Saxon Applications</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../../sql-extension/intro.html">The Saxon SQL Extension</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../../xsl-elements/intro.html">XSLT Elements</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../../expressions/intro.html">XPath 2.0 Expression Syntax</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../../functions/intro.html">Function Library</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../../conformance/intro.html">Standards Conformance</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
         </table>
      </div>
      <div id="MainTextArea" style="position:absolute; height:100%; z-index:5; left: 130px; right: 260px; top: 110px; border: 1px none #000000; visibility: visible;">
         <h1>saxon:for-each-group()</h1>
         <p><b>saxon:for-each-group($population as item()*, $key as jt:net.sf.saxon.expr.UserFunctionCall,
               $action as jt:net.sf.saxon.expr.UserFunctionCall) ==&gt; item()*</b></p>
         <p><i>This function is available only in Saxon-SA</i></p>
         <p>The action of this function is analagous to the <code>xsl:for-each-group</code> instruction
            (with a <code>group-by</code> attribute) in XSLT 2.0. It is provided to give XQuery users access
            to grouping facilities comparable to those provided in XSLT 2.0. (The function is available in XSLT
            also, but is unnecessary in that environment.)
         </p>
         <p>The first argument defines the <i>population</i>, a collection of items to be grouped. These may
            be any items (nodes or atomic values). The second argument is a function (created using 
            <a class="bodylink" href="../../extensions/functions/function.html">saxon:function</a>) that is called once for each item in the
            population, to calculate a grouping key for that item. The third argument is another function
            (also created using <a class="bodylink" href="../../extensions/functions/function.html">saxon:function</a>) that is called once to
            process each group of items from the population.
         </p>
         <p>Two items in the population are in the same group if they have the same value for the grouping
            key. Strings are compared using the default collation. If the value of the grouping key is a sequence
            of more than one item, then an item in the population may appear in more than one group; if it is
            an empty sequence, then the item will appear in no group.
         </p>
         <p>The order in which the groups are processed is subject to change: at present it is the same as
            the default order in <code>xsl:for-each-group</code>, namely order of first appearance. There is no
            way to change this order; if the groups need to be sorted then it is best to sort the output afterwards.
            Each group is passed as an argument to a call on the <i>action</i> function supplied as the third
            argument; the values returned by these calls form the result of the <code>saxon:for-each-group</code>
            call. The items within each group are in their original order (population order).
         </p>
         <p>The following example groups cities by country. It takes input like this:</p>
         <div class="codeblock" style="border: solid thin; background-color: #B1CCC7; padding: 2px"><pre><code>&lt;doc&gt;
&lt;city name="Paris" country="France"/&gt;
&lt;city name="Madrid" country="Spain"/&gt;
&lt;city name="Vienna" country="Austria"/&gt;
&lt;city name="Barcelona" country="Spain"/&gt;
&lt;city name="Salzburg" country="Austria"/&gt;
&lt;city name="Bonn" country="Germany"/&gt;
&lt;city name="Lyon" country="France"/&gt;
&lt;city name="Hannover" country="Germany"/&gt;
&lt;city name="Calais" country="France"/&gt;
&lt;city name="Berlin" country="Germany"/&gt;
&lt;/doc&gt;
</code></pre></div>
         <p>and produces output like this:</p>
         <div class="codeblock" style="border: solid thin; background-color: #B1CCC7; padding: 2px"><pre><code>&lt;out&gt;
   &lt;country leading="Paris" size="3" name="France"&gt;
      &lt;city name="Calais"/&gt;
      &lt;city name="Lyon"/&gt;
      &lt;city name="Paris"/&gt;
   &lt;/country&gt;
   &lt;country leading="Madrid" size="2" name="Spain"&gt;
      &lt;city name="Barcelona"/&gt;
      &lt;city name="Madrid"/&gt;
   &lt;/country&gt;
   &lt;country leading="Vienna" size="2" name="Austria"&gt;
      &lt;city name="Salzburg"/&gt;
      &lt;city name="Vienna"/&gt;
   &lt;/country&gt;
   &lt;country leading="Bonn" size="3" name="Germany"&gt;
      &lt;city name="Berlin"/&gt;
      &lt;city name="Bonn"/&gt;
      &lt;city name="Hannover"/&gt;
   &lt;/country&gt;
&lt;/out&gt;
</code></pre></div>
         <p>The XQuery code to achieve this is:</p>
         <div class="codeblock" style="border: solid thin; background-color: #B1CCC7; padding: 2px"><pre><code>declare namespace f="f.uri";

(: Test saxon:for-each-group extension function :)

declare function f:get-country ($c) { $c/@country };

declare function f:put-country ($group) {
    &lt;country name="{$group[1]/@country}" leading="{$group[1]/@name}" size="{count($group)}"&gt;
       {for $g in $group 
           order by $g/@name
           return &lt;city&gt;{ $g/@name }&lt;/city&gt;
       }
    &lt;/country&gt;
};    

&lt;out&gt;
    {saxon:for-each-group(/*/city, 
                         saxon:function('f:get-country', 1), 
                         saxon:function('f:put-country', 1))}
&lt;/out&gt;
</code></pre></div>
         <table width="100%">
            <tr>
               <td>
                  <p align="right"><a class="nav" href="format-dateTime.html">Next</a></p>
               </td>
            </tr>
         </table>
      </div>
   </body>
</html>