<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
      <!--
		
		Generated at 2007-02-12T11:38:49.726Z-->
      <title>Saxonica: XSLT and XQuery Processing: Extensions</title>
      <meta name="coverage" content="Worldwide">
      <meta name="copyright" content="Copyright Saxonica Ltd">
      <meta name="title" content="Saxonica: XSLT and XQuery Processing: Extensions">
      <meta name="robots" content="noindex,nofollow">
      <link rel="stylesheet" href="../saxondocs.css" type="text/css">
   </head>
   <body class="main">
      <div id="rhDkBlueArea" style="position:absolute; width:123px; height:2079px; z-index:2; right: 0px; top: 0px; border: 1px none #000000; background-color: #C1CEDE; layer-background-color: #C1CEDE; visibility: visible;"></div>
      <div id="rhMdBlueArea" style="position:absolute; width:217px; height:2079px; z-index:2; right: 340px; top: 0px; border: 1px none #000000; background-color: #E4EEF0; layer-background-color: #E4EEF0; visibility: visible;"></div>
      <div id="lhLightArea" style="position:absolute; width:34px; height:2079px; z-index:2; left: 66px; top: 0px; border: 1px none #000000; background-color: #f6fffb; layer-background-color: #E4EEF0; visibility: visible;"></div>
      <div id="lhDkBlueArea" style="position:absolute; width:66px; height:2079px; z-index:2; left: 0px; top: 0px; border: 1px none #000000; background-color: #C1CEDE; layer-background-color: #C1CEDE; visibility: visible;"></div>
      <div id="LogoArea" style="position:absolute; width:340px; height:72px; z-index:3; right: 0px; top: 0px; border: 1px none #000000; visibility: visible;"><a href="../index/intro.html"><img src="../img/saxonica_logo.gif" width="340" height="72" border="0" alt="Saxonica.com"></a></div>
      <div id="MenuArea" style="position:absolute; width:157px; z-index:4; right: 33px; top: 114px; visibility: visible; background-color: #f6fffb; layer-background-color: #f6fffb; border: 1px solid #3D5B96; padding-top:9px; padding-left:15px;padding-right:11px; padding-bottom:9px;">
         <table width="164" border="0" bgcolor="#3D5B96" cellspacing="1" cellpadding="1">
            <tr bgcolor="#f6fffb">
               <td style="padding-left:5px"><a href="http://www.saxonica.com/">SAXONICA</a></td>
            </tr>
         </table><br><table border="0" cellspacing="0" cellpadding="1">
            <tr>
               <td class="title" colspan="2">Saxon Documentation</td>
            </tr>
            <tr>
               <td colspan="2"><img src="../img/spacer.gif" width="120" height="10" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../contents.html">Full Contents</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../index/intro.html">About Saxon</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../changes/intro.html">Changes in this Release</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../conditions/intro.html">Conditions of Use</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../using-xsl/intro.html">Using XSLT 2.0</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../using-xquery/intro.html">Using XQuery</a></td>
            </tr>
            <tr>
               <td><img src="../img/spacer.gif" width="10" height="5" border="0" alt="blank space"></td>
               <td><a href="intro.html">Introduction</a></td>
            </tr>
            <tr>
               <td><img src="../img/spacer.gif" width="10" height="5" border="0" alt="blank space"></td>
               <td><a href="commandline.html">Running XQuery from the Command Line</a></td>
            </tr>
            <tr>
               <td><img src="../img/spacer.gif" width="10" height="5" border="0" alt="blank space"></td>
               <td><a href="xqj.html">Invoking XQuery using the XQJ API</a></td>
            </tr>
            <tr>
               <td><img src="../img/spacer.gif" width="10" height="5" border="0" alt="blank space"></td>
               <td><a href="embedding.html">Invoking XQuery from an application</a></td>
            </tr>
            <tr>
               <td><img src="../img/spacer.gif" width="10" height="5" border="0" alt="blank space"></td>
               <td><a href="callingfunctions.html">Calling XQuery Functions from Java</a></td>
            </tr>
            <tr>
               <td><img src="../img/spacer.gif" width="10" height="5" border="0" alt="blank space"></td>
               <td><a href="resultformat.html">Result Format</a></td>
            </tr>
            <tr>
               <td><img src="../img/spacer.gif" width="10" height="5" border="0" alt="blank space"></td>
               <td><a href="querycompilation.html">Compiling Queries to Java code</a></td>
            </tr>
            <tr>
               <td><img src="../img/spacer.gif" width="10" height="5" border="0" alt="blank space"></td>
               <td><a href="extensibility.html">Extensibility</a></td>
            </tr>
            <tr>
               <td>»&nbsp;</td>
               <td><a href="extensions.html">Extensions</a></td>
            </tr>
            <tr>
               <td><img src="../img/spacer.gif" width="10" height="5" border="0" alt="blank space"></td>
               <td><a href="usecases.html">Use Cases</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../sourcedocs/intro.html">Handling Source Documents</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../schema-processing/intro.html">XML Schema Processing</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../xpath-api/intro.html">XPath API for Java</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../dotnet/intro.html">Saxon on .NET</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../extensibility/intro.html">Extensibility</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../extensions/intro.html">Saxon Extensions</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../samples/intro.html">Sample Saxon Applications</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../sql-extension/intro.html">The Saxon SQL Extension</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../xsl-elements/intro.html">XSLT Elements</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../expressions/intro.html">XPath 2.0 Expression Syntax</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../functions/intro.html">Function Library</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
            <tr>
               <td colspan="2"><a href="../conformance/intro.html">Standards Conformance</a></td>
            </tr>
            <tr>
               <td colspan="2"><img src="../img/text_blue_dot.gif" width="164" height="1" border="0" alt=""></td>
            </tr>
         </table>
      </div>
      <div id="MainTextArea" style="position:absolute; height:100%; z-index:5; left: 130px; right: 260px; top: 110px; border: 1px none #000000; visibility: visible;">
         <h1>Extensions</h1>
         <p>The full library of Saxon and EXSLT functions described in <a class="bodylink" href="../extensions/intro.html">Extensions</a>
            is available, except for those (for example, some forms of <code>saxon:serialize</code>) 
            that have an intrinsic dependency on an XSLT stylesheet.
         </p>
         <p class="subhead">declare option saxon:default</p>
         <p>An XQuery option declaration is defined allowing a default value to be specified for a query parameter (external variable).
            The syntax is illustrated below:
         </p>
         <div class="codeblock" style="border: solid thin; background-color: #B1CCC7; padding: 2px"><pre><code>
declare namespace saxon="http://saxon.sf.net/";
declare option saxon:default "20";
declare variable $x external;
</code></pre></div>
         <p>The default value is written as an XPath expression. The surrounding quotes are part of the "declare option"
            syntax, not part of the expression: therefore, if the default value is to be supplied as a string literal, two
            sets of quotes are needed. In the above example, the default value is the integer 20, not a string.
            Perhaps it would be clearer to show this by writing <code>saxon:default "(+20)"</code></p>
         <p class="subhead">declare option saxon:output</p>
         <p>Saxon provides an option declaration to set serialization parameters. This takes the form
            shown in the following example:
         </p>
         <div class="codeblock" style="border: solid thin; background-color: #B1CCC7; padding: 2px"><pre><code>
declare namespace saxon="http://saxon.sf.net/";
declare option saxon:output "method=html";
declare option saxon:output "saxon:indent-spaces=1";
</code></pre></div>
         <p class="subhead">declare option saxon:memo-function</p>
         <p>Saxon provides an option declaration to treat the immediately following function as a memo-function. 
            This takes the form shown in the following example:
         </p>
         <div class="codeblock" style="border: solid thin; background-color: #B1CCC7; padding: 2px"><pre><code>
declare namespace saxon="http://saxon.sf.net/";
declare option saxon:memo-function "true";
declare function local:factorial($n as xs:integer) as xs:integer {
  local:factorial($n - 1) * n
};
</code></pre></div>
         <p>A memo function remembers the results of previous calls, so if it is called twice with the same
            arguments, it will not repeat the computation, but return the previous result.
         </p>
         <p>The allowed values of the option are "true" and "false" (the default is false), and any other value
            is ignored with a warning.
         </p>
         <p class="subhead">declare option saxon:allow-cycles</p>
         <p>Saxon checks for the error XQST0093 which was introduced in the Proposed Recommendation. This error
            makes it illegal for a function or variable in module A to reference a function or variable in module B if there
            is a function or variable in module B that references one in A. Because this restriction is quite unnecessary
            and makes it very difficult to write modular applications, Saxon provides an option
            <code>declare option saxon:allow-cycles "true"</code> to disable this check. This option also disables
            error XQST0073, which otherwise occurs when two modules in different namespaces import each other
         </p>
         <p>The allowed values of the option are "true" and "false" (the default is false), and any other value
            is ignored with a warning.
         </p>
         <p>This option does not disable the check for cycles that would actually cause execution to fail, for
            example a global variable $V1 whose initializer uses $V2, when $V2 similarly depends on $V1.
         </p>
         <p>Note that this option declaration must be written <i>after</i> the module imports, but before any
            variable or function declarations.
         </p>
         <p class="subhead">The saxon:validate-type pragma</p>
         <p>Saxon-SA provides a pragma (a language extension) to allow constructed elements to be validated
            against a schema-defined global type definition. The standard <code>validate</code> expression allows validation
            only against a global element declaration, but some schemas (an example is FpML) provide very few global elements,
            and instead rely heavily on locally-declared elements having a global type. This makes it impossible to construct
            fragments of an FpML document in a way that takes advantage of static and dynamic type checking.
         </p>
         <p>The extension takes the form:</p>
         <div class="codeblock" style="border: solid thin; background-color: #B1CCC7; padding: 2px"><pre><code>
(# saxon:validate-type my:personType #) { expr }
</code></pre></div>
         <p>Conceptually, it makes a copy of the result of evaluating <code>expr</code> and validates it against the named
            schema type, causing the copied nodes to acquire type annotations based on the validation process. The effect is the
            same as that of the <code>type</code> attribute in XSLT instructions such as <code>xsl:element</code> and
            <code>xsl:copy-of</code>. The schema type (shown in the above example as <code>myPersonType</code>) may be a 
            simple type or a complex type defined in an imported schema, or a built-in type; it is written as a QName,
            using the default namespace for elements and types if it is unprefixed.
         </p>
         <p>Note that XQuery processors other than Saxon will typically ignore this pragma, and return the value of
            <code>expr</code> unchanged. Such processors will report type-checking failures if the value is used in a 
            context where the required type is <code>element(*, type-name)</code>.
         </p>
         <p>You can use a different namespace prefix in place of "saxon", but it must be bound using a 
            namespace declaration to the namespace "http://saxon.sf.net/".
         </p>
         <p>Here is a complete example:</p>
         <div class="codeblock" style="border: solid thin; background-color: #B1CCC7; padding: 2px"><pre><code>
module namespace tim="http://www.example.com/module/hour-minute-time";
declare namespace saxon="http://saxon.sf.net/";
import schema namespace fpml = "http://www.fpml.org/2005/FpML-4-2" at "....";

declare function time:getCurrentHourMinuteTime() as element(*, fpml:HourMinuteTime) {
    (# saxon:validate-type fpml:HourMinuteTime #) {
        let $time = string(current-time())
        return &lt;time&gt;{substring($time, 1, 5)}:00&lt;/time&gt;
    }
};        
</code></pre></div>
         <p>Saxon ignores any pragmas in a namespace other than the Saxon namespace; it rejects any pragmas whose QName is
            ill-formed, as well as pragmas in the Saxon namespace whose local name is not recognized.
         </p>
         <table width="100%">
            <tr>
               <td>
                  <p align="right"><a class="nav" href="usecases.html">Next</a></p>
               </td>
            </tr>
         </table>
      </div>
   </body>
</html>